{% extends "pamphlet/base.html" %}
{%load bootstrap4 %}
{% load static %}


{% block content %}

    <script src="{% static 'js/handlebars-v4.7.7.js'%}"></script>
    <script src="{% static 'js/jquery-3.6.0.min.js'%}"></script>
    <link  rel="stylesheet" href="{% static 'emoji-picker-main/lib/css/emoji.css'%}">

    <style>
        .status-box{
            border-width: 1px;
            border-color: lightgrey;
            border-style: none none solid none;
            background-color: white;
        }
        main{
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .friends-container{
            height: 100%;
            background-color: white;
        }
        .friend-box{
            background-color: white;
            padding: 20px;
            border-bottom: 1px solid lightgray;
        }
        .chat-button{
            position: absolute;
            transform: translate(0,-150%);
        }
        .chat-button-wrapper {
            display: flex;
        }
        .user-info-container{
            cursor: pointer;
            display: flex;
            flex-direction: row;
        }
    </style>
    <div>

    </div>
        <div style="width: 100%;display: flex;flex-direction: row;">
            <div class="col-sm-6 col-md-6 col-lg-8" style="border-right: 1px solid lightgrey;height: 100%;">
                <div style="width: 100%;">
                    {%include './profile.html'  with is_editable=False%}
                </div>
            </div>
            <div id="friends-list-container"class="friends-container container col-12 col-sm-6 col-md-6 col-lg-4">
            </div>

 
        </div>


    {% verbatim %}
        <script type="text/template" id="single-friend-box" >
            {{#each result}}
                        <div class="friend-box " user_id="{{user_id}}">
                            <div class="user-info-container">
                                <div>
                                    <img class='avatar-icon' alt='profile' value='{{user_id}}'>

                                </div>   
                                <div>
                                    {{user_custom_name}}
                                    <p class="date-info">{{user_id}}</p>
                                </div>   

                            </div>
                            <div class="chat-button-wrapper justify-content-end" >
                                <button class='btn btn-primary chat-button' onclick="chat_with_friend('{{user_id}}')">Chat</button>

                            </div>
                        </div>
            {{/each}}
        </script>
    {% endverbatim %}

<script>
    $.ajax(
        {
            type:"GET",
            url:"/api/get-friends-list/",
            success:function(data){
                console.log('get friend list')
                console.log(data)
                display_friend_list(data)
                loadStatusAvatar($("#friends-list-container"))
            },
            error:function(result){
                console.log(result.responseText)
            }

        }
    )
    function display_friend_list(data){
        data_dict ={result:data}
        console.log(data_dict)
        var tpl = $("#single-friend-box").html()
        var template = Handlebars.compile(tpl)
        var html = template(data_dict)
        $("#friends-list-container").html(html)
        $('.friend-box').each(function(){
            var uid = $(this).attr('user_id') 
            $(this).find('.user-info-container').on('click',function(){
                $.ajax(
                    {
                        type:"GET",
                        url:"/api/get-profile/"+uid,
                        success:function(data){
                            console.log('get profile')
                            loadProfile(data);
                            loadProfileStatus(data)
                            remove_delete_status_button()
                        },
                        error:function(result){
                            console.log(result.responseText)
                        }

                    }
                )
            })
        })
        
    }
    function chat_with_friend(friend_id){
        //window.location.href="/private-chat-room/"+friend_id+"/"
        window.open("/private-chat-room/"+friend_id+"/", '_blank').focus();
    }
</script>
<script src="{% static 'js/status.js'%}"></script>

{% endblock%}